---
title: "Story 4.4: emit-analytics-and-whatsapp-deeplink"
status: Draft
owner: scrum-master
---

# Story 4.4 â€” Emit analytics; add optional WhatsApp deep link

## Status
Approved
In Review

## Story

**As a** developer,
**I want** to emit analytics events for form interactions and add an optional WhatsApp deep link on success,
**so that** we capture engagement signals and provide a secondary contact path.

## Acceptance Criteria

1. Events emitted: `form_open`, `form_submit_success`, `form_submit_error`, `whatsapp_deeplink`. [Source: prd/06-features.md#6.7]
2. Dedupe visibility/interaction events; no duplicates on mounts. [Source: architecture/02-frontend-application-architecture.md#2.9]
3. WhatsApp deep link uses `content.form.whatsappPrefill`. [Source: architecture/03-backend-and-integrations.md#3.8; prd/05-content-and-information-architecture.md#5.3]

## Tasks / Subtasks

- [x] In `SlideOverForm`, fire `form_open` on open, `form_submit_*` on result
- [x] Add optional WhatsApp button on success: `wa.me/<number>?text=<prefill>`
- [x] Ensure `track()` payload includes `{ path, ts, deviceType }` and contextual fields
- [x] Dedupe events using a ref/WeakSet to avoid duplicates

## Dev Notes

### Analytics Dispatcher

- Use `lib/analytics/track.ts` and ensure once-per-visibility semantics. [Source: architecture/02-frontend-application-architecture.md#2.9]

### WhatsApp Link

- Add deep link and emit `whatsapp_deeplink` when clicked. [Source: architecture/03-backend-and-integrations.md#3.8]

## Testing

- Manual: open/submit the form and verify analytics events in preview.
- Verify WhatsApp link opens with prefilled message; event emitted once.

## Dev Agent Record
- Enhanced `track()` to include common fields and Vercel Analytics shim.
- `SlideOverForm` now emits `form_open`, `form_submit_success`/`error`, and renders a WhatsApp deep link on success when a number is provided, emitting `whatsapp_deeplink` on click.

## Change Log

| Date       | Version | Description                                        | Author |
| ---------- | ------- | -------------------------------------------------- | ------ |
| 2025-08-08 | 0.1     | Draft for form analytics + WhatsApp deeplink added | SM     |

## Dev Agent Record

To be filled by the development agent during implementation.
