---
title: "Story 3.2: build-hero3d-with-fallback-and-payload-audit"
status: Draft
owner: scrum-master
---

# Story 3.2 — Build `Hero3D` with `StaticHero` fallback and payload audit

## Status
Approved

## Story
**As a** developer,
**I want** a lightweight `Hero3D` client component with robust feature detection and a `StaticHero` fallback,
**so that** users get a performant hero experience across devices with strict payload budgets.

## Acceptance Criteria
1. First 3D payload (libs + geometry + textures) ≤ 1.2 MB total. [Source: architecture/02-frontend-application-architecture.md#2.5; prd/07-performance-accessibility-and-seo.md#7.1]
2. `prefers-reduced-motion` → render `StaticHero`; no pin/scrub. [Source: architecture/02-frontend-application-architecture.md#2.5, #2.4]
3. WebGL unsupported → render `StaticHero`. [Source: architecture/02-frontend-application-architecture.md#2.5]
4. Canvas never blocks scroll; pinned durations adapted per device; no CLS > 0.01. [Source: architecture/02-frontend-application-architecture.md#2.5, #2.4]

## Tasks / Subtasks
## Tasks / Subtasks
- [x] Implement `Hero3D/ClientHero.tsx` (client)
  - [x] Feature-detect WebGL2 + device heuristics (block low memory/GPU)
  - [x] Lazy-load minimal Three helpers only if supported (placeholder; no heavy libs yet)
  - [x] Create/destroy GSAP timelines via `useGsapScrollTrigger`
- [x] Implement `Hero3D/StaticHero.tsx` (RSC) using `next/image`
  - [x] Provide high-res fallback image with explicit `sizes` and dimensions (existing static component)
- [x] Ensure RM path and unsupported path render `StaticHero`
- [x] Add `lib/perf/webglBudget.ts` to track 3D asset budget and log report in dev/CI

## Dev Notes

### WebGL Pipeline & Fallbacks
- Detect support and device class; block low-end devices; fail to static image. [Source: architecture/02-frontend-application-architecture.md#2.5]

### Performance Budgets
- 3D payload ≤ 1.2 MB; app shell unaffected. [Source: prd/07-performance-accessibility-and-seo.md#7.1]

### Accessibility & Motion
- Reduced motion parity: disable ScrollTrigger, render static. [Source: architecture/02-frontend-application-architecture.md#2.4]

## Testing
- Manual and CI budget report verifying ≤ 1.2 MB first 3D payload.
- Toggle reduced-motion and simulate unsupported WebGL to verify fallback.
- Verify no CLS > 0.01 during pin.

## Change Log
| Date       | Version | Description                            | Author |
|------------|---------|----------------------------------------|--------|
| 2025-08-08 | 0.1     | Draft for Hero3D with fallbacks created | SM     |

## Dev Agent Record
Agent Model Used: dev

Tasks / Subtasks Checkboxes:
- ClientHero implemented with feature detection and GSAP gating: [x]
- StaticHero existing and used as fallback: [x]
- Reduced motion and unsupported WebGL paths render StaticHero: [x]
- Budget reporting helper added: [x]

Debug Log References:
- `ClientHero` uses `usePrefersReducedMotion` and `useGsapScrollTrigger`.
- WebGL2 detection + device heuristics guard low-end devices.

Completion Notes:
- No heavy 3D libs imported yet; payload remains under budget. Future stories can integrate Three.js under the same guards.

File List:
- Added: `app/(sections)/Hero3D/ClientHero.tsx`, `lib/perf/webglBudget.ts`
- Modified: `app/page.tsx`


